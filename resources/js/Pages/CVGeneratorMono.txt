import React, { useState } from 'react';
import * as XLSX from 'xlsx';

const CVImportGenerator = () => {
  const [excelData, setExcelData] = useState([]);
  const [selectedPerson, setSelectedPerson] = useState(null);
  const [photos, setPhotos] = useState({});
  const [isGenerating, setIsGenerating] = useState(false);
  const [logoData, setLogoData] = useState(null);
  const [logo2Data, setLogo2Data] = useState(null);
  const [isDarkMode, setIsDarkMode] = useState(false);

  React.useEffect(() => {
    const loadLogos = async () => {
      try {
        const response1 = await fetch('/storage/logo/loring_logo.jpg');
        const blob1 = await response1.blob();
        const reader1 = new FileReader();
        reader1.onloadend = () => setLogoData(reader1.result);
        reader1.readAsDataURL(blob1);

        const response2 = await fetch('/storage/logo/fatika_logo.jpg');
        const blob2 = await response2.blob();
        const reader2 = new FileReader();
        reader2.onloadend = () => setLogo2Data(reader2.result);
        reader2.readAsDataURL(blob2);
      } catch (error) {
        console.error('Failed to load logos:', error);
      }
    };
    loadLogos();
  }, []);

  const handleFileUpload = (e) => {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = (evt) => {
      const data = new Uint8Array(evt.target.result);
      const workbook = XLSX.read(data, { type: 'array' });
      const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
      const jsonData = XLSX.utils.sheet_to_json(firstSheet);
      
      setExcelData(jsonData);
      if (jsonData.length > 0) setSelectedPerson(jsonData[0]);
    };
    reader.readAsArrayBuffer(file);
  };

  const handleLogoUpload = (e) => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (evt) => setLogoData(evt.target.result);
    reader.readAsDataURL(file);
  };

  const handleLogo2Upload = (e) => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (evt) => setLogo2Data(evt.target.result);
    reader.readAsDataURL(file);
  };

  const handlePhotoUpload = (personIndex, e) => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (evt) => {
      setPhotos(prev => ({ ...prev, [personIndex]: evt.target.result }));
    };
    reader.readAsDataURL(file);
  };

  const removePhoto = (personIndex) => {
    setPhotos(prev => {
      const newPhotos = { ...prev };
      delete newPhotos[personIndex];
      return newPhotos;
    });
  };

  const parseEducation = (person) => {
    const education = [];
    for (let i = 1; i <= 2; i++) {
      const school = person[`edu_${i}_school`];
      if (school) {
        education.push({
          school: school,
          major: person[`edu_${i}_study`] || '',
          startDate: person[`edu_${i}_start_date`] || '',
          gradDate: person[`edu_${i}_graduation_date`] || ''
        });
      }
    }
    return education;
  };

  const parseWorkExperience = (person) => {
    const work = [];
    for (let i = 1; i <= 3; i++) {
      const company = person[`work_${i}_employer`];
      if (company) {
        work.push({
          company: company,
          position: person[`work_${i}_position`] || '',
          startDate: person[`work_${i}_start_date`] || '',
          leavingDate: person[`work_${i}_leaving_date`] || ''
        });
      }
    }
    return work;
  };

  const parseLanguages = (person) => {
    const languages = [];
    const langKeys = ['lang_english', 'lang_russian', 'lang_turkish', 'lang_other'];
    const langNames = ['English / Ä°NGÄ°LÄ°ZCE', 'Russian / RUSÃ‡A', 'Turkish / TÃœRKÃ‡E', 'Other / DÄ°ÄžER'];
    
    langKeys.forEach((key, idx) => {
      const level = person[key];
      if (level) {
        languages.push({ name: langNames[idx], level: level });
      }
    });
    return languages;
  };

  const parseSkills = (person) => {
    return {
      msWord: person.skill_ms_word || '',
      msExcel: person.skill_ms_excel || '',
      msOutlook: person.skill_ms_outlook || '',
      other: person.skill_other || '',
      otherSkills: person.other_skills || ''
    };
  };

  const generateCVHTML = (person, photoData, companyLogo, companyLogo2) => {
    const education = parseEducation(person);
    const workExperience = parseWorkExperience(person);
    const languages = parseLanguages(person);
    const skills = parseSkills(person);

    return `<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>CV - ${person.full_name || ''}</title>
    <style>
        @page { size: A4; margin: 0; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 0;
            font-size: 9pt;
            background: #fff;
            -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
        }
        .page {
            width: 210mm;
            min-height: 297mm;
            padding: 10mm 15mm;
            margin: 0 auto;
            background: white;
            page-break-after: always;
        }
        .page:last-child { page-break-after: auto; }
        .header {
            display: flex;
            align-items: flex-start;
            border: 2px solid #000;
            margin-bottom: 8px;
        }
        .header-left {
            display: flex;
            align-items: center;
            padding: 8px;
        }
        .photo-container {
            width: 90px;
            height: 110px;
            border: 2px solid #000;
            margin-right: 10px;
            overflow: hidden;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .photo-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .header-text { flex: 1; }
        .header-text table {
            width: 100%;
            border-collapse: collapse;
        }
        .header-text td {
            border: 1px solid #000;
            padding: 4px 8px;
            font-size: 9pt;
        }
        .header-text .label-col {
            width: 180px;
            background: #e0e0e0;
            font-weight: bold;
            -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
        }
        .header-right {
            width: 130px;
            display: flex;
            flex-direction: column;
            border-left: 2px solid #000;
        }
        .logo-box {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 8px;
            border-bottom: 2px solid #000;
            background: #fff;
        }
        .logo-box img {
            max-width: 100%;
            max-height: 50px;
            object-fit: contain;
        }
        .company-header {
            padding: 6px;
            text-align: center;
            background: #fff;
        }
        .company-name {
            font-size: 11pt;
            font-weight: bold;
            margin-bottom: 2px;
        }
        .section-title {
            background: #e0e0e0;
            border: 2px solid #000;
            padding: 4px;
            font-weight: bold;
            text-align: center;
            margin-top: 6px;
            margin-bottom: 0;
            font-size: 9.5pt;
            -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
        }
        table.data-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 0;
        }
        .data-table td, .data-table th {
            border: 1px solid #000;
            padding: 3px 6px;
            font-size: 9pt;
            vertical-align: middle;
        }
        .data-table th {
            background: #e0e0e0;
            font-weight: bold;
            text-align: center;
            -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
        }
        .data-table .label-col {
            width: 180px;
            background: #e0e0e0;
            font-weight: bold;
            -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
        }
        .center-text { text-align: center; }
    </style>
</head>
<body>
<div class="page">
    <div class="header">
        <div class="header-left">
            <div class="photo-container">
                ${photoData ? `<img src="${photoData}" alt="Photo" />` : '<div style="font-size:10pt;font-weight:bold;">PHOTO</div>'}
            </div>
            <div class="header-text">
                <table>
                    <tr>
                        <td class="label-col">FULL NAME / ADI SOYADI</td>
                        <td><strong>${person.full_name || ''}</strong></td>
                    </tr>
                    <tr>
                        <td class="label-col">OBJECTIVE / HEDEF</td>
                        <td>${person.objective || ''}</td>
                    </tr>
                    <tr>
                        <td class="label-col">POSITION APPLIED FOR / BAÅžVURULAN POZÄ°SYON</td>
                        <td>${person.position_applied || ''}</td>
                    </tr>
                </table>
            </div>
        </div>
        <div class="header-right">
            <div class="logo-box">
                ${companyLogo ? `<img src="${companyLogo}" alt="Logo 1" />` : ''}
            </div>
            <div class="company-header">
                <div class="company-name">PT. LORING MARGI</div>
                <div class="company-name">INTERNASIONAL</div>
            </div>
            <div class="logo-box">
                ${companyLogo2 ? `<img src="${companyLogo2}" alt="Logo 2" />` : ''}
            </div>
        </div>
    </div>

    <div class="section-title">PERSONAL DETAILS / KÄ°ÅžÄ°SEL BÄ°LGÄ°LER</div>
    <table class="data-table">
        <tr><td class="label-col">AGE / YAÅž</td><td>${person.age || ''}</td></tr>
        <tr><td class="label-col">SEX / CÄ°NSÄ°YET</td><td>${person.sex || ''}</td></tr>
        <tr><td class="label-col">HEIGHT / BOY</td><td>${person.height || ''}</td></tr>
        <tr><td class="label-col">WEIGHT / KÄ°LO</td><td>${person.weight || ''}</td></tr>
        <tr><td class="label-col">ADDRESS / ADRES</td><td>${person.address || ''}</td></tr>
        <tr><td class="label-col">MOBILE PHONE / CEP TELEFONU</td><td>${person.mobile_phone || ''}</td></tr>
        <tr><td class="label-col">EMAIL ADDRESS / EMAÄ°L ADRESÄ°</td><td>${person.email_address || ''}</td></tr>
        <tr><td class="label-col">PLACE OF BIRTH / DOÄžUM YERÄ°</td><td>${person.place_of_birth || ''}</td></tr>
        <tr><td class="label-col">DATE OF BIRTH / DOÄžUM TARÄ°HÄ°</td><td>${person.date_of_birth || ''}</td></tr>
        <tr><td class="label-col">NATIONALITY / MÄ°LLÄ°YETÄ°</td><td>${person.nationality || ''}</td></tr>
        <tr><td class="label-col">MARITAL STATUS / MEDENÄ° DURUMU</td><td>${person.marital_status || ''}</td></tr>
        <tr><td class="label-col">PASSPORT NUMBER / PASAPORT NUMARASI</td><td>${person.passport_number || ''}</td></tr>
        <tr><td class="label-col">PASSPORT EXPIRY DATE / PASAPORT GEÃ‡ERLÄ°LÄ°K TARÄ°HÄ°</td><td>${person.passport_expiry_date || ''}</td></tr>
    </table>

    <div class="section-title">WORK EXPERIENCES / Ä°Åž TECRÃœBELERÄ°</div>
    <table class="data-table">
        <thead>
            <tr>
                <th style="width: 35%;">NAME OF EMPLOYER / Ä°ÅžVERENÄ°N ADI</th>
                <th style="width: 35%;">POSITION & RESPONSIBILITIES / GÃ–REV VE SORUMLULUKLAR</th>
                <th style="width: 15%;">STARTING DATE / BAÅžLANGIÃ‡ TARÄ°HÄ°</th>
                <th style="width: 15%;">LEAVING DATE / AYRILIÅž TARÄ°HÄ°</th>
            </tr>
        </thead>
        <tbody>
            ${workExperience.map(work => `<tr>
                <td>${work.company}</td>
                <td>${work.position}</td>
                <td class="center-text">${work.startDate}</td>
                <td class="center-text">${work.leavingDate}</td>
            </tr>`).join('')}
            ${workExperience.length < 3 ? Array(3 - workExperience.length).fill('<tr><td></td><td></td><td></td><td></td></tr>').join('') : ''}
        </tbody>
    </table>

    <div class="section-title">EDUCATION HISTORY / EÄžÄ°TÄ°M DURUMU</div>
    <table class="data-table">
        <thead>
            <tr>
                <th style="width: 40%;">SCHOOL NAME / OKULUN ADI</th>
                <th style="width: 30%;">STUDY / BÃ–LÃœM</th>
                <th style="width: 15%;">STARTING DATE / BAÅžLANGIÃ‡ TARÄ°HÄ°</th>
                <th style="width: 15%;">GRADUATION DATE / AYRILIÅž TARÄ°HÄ°</th>
            </tr>
        </thead>
        <tbody>
            ${education.map(edu => `<tr>
                <td>${edu.school}</td>
                <td>${edu.major}</td>
                <td class="center-text">${edu.startDate}</td>
                <td class="center-text">${edu.gradDate}</td>
            </tr>`).join('')}
            ${education.length < 2 ? Array(2 - education.length).fill('<tr><td></td><td></td><td></td><td></td></tr>').join('') : ''}
        </tbody>
    </table>

    <div class="section-title">QUALIFICATION & SKILLS / YETKÄ°NLÄ°K VE YETENEKLER</div>
    <table class="data-table">
        <thead>
            <tr>
                <th style="width: 20%;">LANGUAGE SKILLS / YABANCI DÄ°L</th>
                ${languages.map(lang => `<th>${lang.name}</th>`).join('')}
                ${languages.length < 4 ? '<th>OTHER / DÄ°ÄžER</th>' : ''}
            </tr>
        </thead>
        <tbody>
            <tr>
                <td class="center-text">Fluent - Good - Beginner</td>
                ${languages.map(lang => `<td class="center-text">${lang.level}</td>`).join('')}
                ${languages.length < 4 ? '<td></td>' : ''}
            </tr>
        </tbody>
    </table>

    <table class="data-table" style="margin-top: 6px;">
        <thead>
            <tr>
                <th style="width: 20%;">PC SKILLS / BÄ°LGÄ°SAYAR</th>
                <th>MS WORD</th>
                <th>MS EXCEL</th>
                <th>MS OUTLOOK</th>
                <th>OTHER / DÄ°ÄžER</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td></td>
                <td class="center-text">${skills.msWord}</td>
                <td class="center-text">${skills.msExcel}</td>
                <td class="center-text">${skills.msOutlook}</td>
                <td class="center-text">${skills.other}</td>
            </tr>
        </tbody>
    </table>

    <table class="data-table" style="margin-top: 6px;">
        <thead>
            <tr><th>OTHER SKILLS / DÄ°ÄžER</th></tr>
        </thead>
        <tbody>
            <tr><td>${skills.otherSkills}</td></tr>
        </tbody>
    </table>
</div>
</body>
</html>`;
  };

  const downloadHTML = () => {
    if (!selectedPerson) return;
    const personIndex = excelData.indexOf(selectedPerson);
    const photoData = photos[personIndex];
    const html = generateCVHTML(selectedPerson, photoData, logoData, logo2Data);
    const blob = new Blob([html], { type: 'text/html' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `CV_${selectedPerson.full_name || 'unnamed'}.html`;
    a.click();
    URL.revokeObjectURL(url);
  };

  const downloadPDF = async () => {
    if (!selectedPerson) return;
    setIsGenerating(true);
    try {
      const personIndex = excelData.indexOf(selectedPerson);
      const photoData = photos[personIndex];
      const html = generateCVHTML(selectedPerson, photoData, logoData, logo2Data);
      
      const iframe = document.createElement('iframe');
      iframe.style.position = 'absolute';
      iframe.style.left = '-9999px';
      iframe.style.width = '210mm';
      iframe.style.height = '297mm';
      document.body.appendChild(iframe);
      
      iframe.contentDocument.open();
      iframe.contentDocument.write(html);
      iframe.contentDocument.close();
      
      await new Promise(resolve => setTimeout(resolve, 500));
      iframe.contentWindow.print();
      setTimeout(() => document.body.removeChild(iframe), 1000);
    } catch (error) {
      console.error('Error generating PDF:', error);
      alert('Error generating PDF. Please try downloading HTML instead.');
    } finally {
      setIsGenerating(false);
    }
  };

  const bulkPrintPDF = async () => {
    if (excelData.length === 0) return;
    setIsGenerating(true);
    try {
      const sampleCV = generateCVHTML(excelData[0], photos[0], logoData, logo2Data);
      const styleMatch = sampleCV.match(/<style>(.*?)<\/style>/s);
      
      let combinedHTML = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>Bulk CV Print - ${excelData.length} CVs</title>`;
      if (styleMatch) combinedHTML += `<style>${styleMatch[1]}</style>`;
      combinedHTML += `</head><body>`;
      
      for (let i = 0; i < excelData.length; i++) {
        const person = excelData[i];
        const photoData = photos[i];
        const singleCV = generateCVHTML(person, photoData, logoData, logo2Data);
        const pageMatch = singleCV.match(/<div class="page">(.*?)<\/div>\s*<\/body>/s);
        if (pageMatch) combinedHTML += `<div class="page">${pageMatch[1]}</div>`;
      }
      
      combinedHTML += '</body></html>';
      
      const iframe = document.createElement('iframe');
      iframe.style.position = 'absolute';
      iframe.style.left = '-9999px';
      iframe.style.width = '210mm';
      iframe.style.height = '297mm';
      document.body.appendChild(iframe);
      
      iframe.contentDocument.open();
      iframe.contentDocument.write(combinedHTML);
      iframe.contentDocument.close();
      
      await new Promise(resolve => setTimeout(resolve, 1500));
      iframe.contentWindow.print();
      setTimeout(() => document.body.removeChild(iframe), 1000);
    } catch (error) {
      console.error('Error generating bulk PDF:', error);
      alert('Error generating bulk PDF. Please try again.');
    } finally {
      setIsGenerating(false);
    }
  };

  const bulkDownloadHTML = () => {
    if (excelData.length === 0) return;
    const sampleCV = generateCVHTML(excelData[0], photos[0], logoData, logo2Data);
    const styleMatch = sampleCV.match(/<style>(.*?)<\/style>/s);
    
    let combinedHTML = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>All CVs - ${excelData.length} Persons</title>`;
    if (styleMatch) combinedHTML += `<style>${styleMatch[1]}</style>`;
    combinedHTML += '</head><body>';
    
    for (let i = 0; i < excelData.length; i++) {
      const person = excelData[i];
      const photoData = photos[i];
      const singleCV = generateCVHTML(person, photoData, logoData, logo2Data);
      const pageMatch = singleCV.match(/<div class="page">(.*?)<\/div>\s*<\/body>/s);
      if (pageMatch) combinedHTML += `<div class="page">${pageMatch[1]}</div>`;
    }
    
    combinedHTML += '</body></html>';
    
    const blob = new Blob([combinedHTML], { type: 'text/html' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `All_CVs_${excelData.length}_persons.html`;
    a.click();
    URL.revokeObjectURL(url);
  };

  const previewCV = () => {
    if (!selectedPerson) return;
    const personIndex = excelData.indexOf(selectedPerson);
    const photoData = photos[personIndex];
    const html = generateCVHTML(selectedPerson, photoData, logoData, logo2Data);
    const newWindow = window.open();
    newWindow.document.write(html);
    newWindow.document.close();
  };

  return (
    <div className={`min-h-screen p-3 sm:p-6 transition-colors duration-300 ${isDarkMode ? 'bg-gray-900' : 'bg-white'}`} style={{fontFamily: 'Montserrat, sans-serif'}}>
      <style>{`
        @keyframes fadeInUp {
          from { opacity: 0; transform: translateY(20px); }
          to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideIn {
          from { opacity: 0; transform: translateX(-20px); }
          to { opacity: 1; transform: translateX(0); }
        }
        @keyframes pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.5; }
        }
        .animate-fadeInUp { animation: fadeInUp 0.6s ease-out; }
        .animate-slideIn { animation: slideIn 0.5s ease-out; }
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        .card { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .card:hover { transform: translateY(-2px); }
        .btn { transition: all 0.2s ease; }
        .btn:hover:not(:disabled) { transform: translateY(-2px); }
        .btn:active:not(:disabled) { transform: translateY(0); }
      `}</style>
      
      <div className="max-w-6xl mx-auto">
        
        {/* DARK MODE TOGGLE */}
        <div className="flex justify-end mb-4 sm:mb-6 animate-fadeInUp">
          <button
            onClick={() => setIsDarkMode(!isDarkMode)}
            className={`btn font-black px-4 sm:px-6 py-2 sm:py-3 border-2 sm:border-4 transition-all duration-200 uppercase tracking-wide text-xs sm:text-sm ${
              isDarkMode 
                ? 'bg-white text-black border-white shadow-[3px_3px_0px_0px_rgba(255,255,255,1)] sm:shadow-[4px_4px_0px_0px_rgba(255,255,255,1)] hover:bg-black hover:text-white hover:border-white' 
                : 'bg-black text-white border-black shadow-[3px_3px_0px_0px_rgba(0,0,0,1)] sm:shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] hover:bg-white hover:text-black hover:border-black'
            }`}
          >
            {isDarkMode ? 'â˜€ LIGHT MODE' : 'ðŸŒ™ DARK MODE'}
          </button>
        </div>

        {/* HEADER CARD */}
        <div className={`card border-2 sm:border-4 p-4 sm:p-8 mb-4 sm:mb-8 animate-fadeInUp ${
          isDarkMode 
            ? 'bg-gray-800 border-white shadow-[4px_4px_0px_0px_rgba(255,255,255,1)] sm:shadow-[8px_8px_0px_0px_rgba(255,255,255,1)]' 
            : 'bg-white border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] sm:shadow-[8px_8px_0px_0px_rgba(0,0,0,1)]'
        }`}>
          <div className="mb-2 sm:mb-3">
            <h1 className={`text-2xl sm:text-4xl font-black tracking-tight uppercase ${isDarkMode ? 'text-white' : 'text-black'}`}>
              CV GENERATOR
            </h1>
          </div>
          <p className={`font-semibold uppercase text-xs sm:text-sm tracking-wide ${isDarkMode ? 'text-gray-300' : 'text-gray-800'}`}>
            UPLOAD LOGO, EXCEL & FOTO â†’ GENERATE CV PDF FORMAT PT. LORING MARGI INTERNASIONAL
          </p>
        </div>

        {/* LOGO SECTION */}
        <div className={`card border-2 sm:border-4 p-4 sm:p-8 mb-4 sm:mb-8 animate-fadeInUp ${
          isDarkMode 
            ? 'bg-gray-800 border-white shadow-[4px_4px_0px_0px_rgba(255,255,255,1)] sm:shadow-[8px_8px_0px_0px_rgba(255,255,255,1)]' 
            : 'bg-white border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] sm:shadow-[8px_8px_0px_0px_rgba(0,0,0,1)]'
        }`} style={{animationDelay: '0.1s'}}>
          <h2 className={`text-xl sm:text-2xl font-black mb-4 sm:mb-6 uppercase tracking-wide ${isDarkMode ? 'text-white' : 'text-black'}`}>
            LOGO PERUSAHAAN
          </h2>
          
          {/* Logo 1 */}
          <div className="mb-6 pb-6 border-b-2" style={{borderColor: isDarkMode ? '#fff' : '#000'}}>
            <h3 className={`text-lg sm:text-xl font-black mb-3 uppercase ${isDarkMode ? 'text-white' : 'text-black'}`}>
              LOGO 1 - PT. LORING MARGI
            </h3>
            <div className="flex flex-col sm:flex-row items-center gap-4 sm:gap-6">
              <div className={`flex flex-col items-center justify-center w-40 h-40 sm:w-48 sm:h-48 border-2 sm:border-4 ${
                isDarkMode ? 'border-white bg-gray-700' : 'border-black bg-gray-50'
              }`}>
                {logoData ? (
                  <img src={logoData} alt="Logo 1" className="w-28 h-28 sm:w-32 sm:h-32 object-contain" />
                ) : (
                  <div className="text-center">
                    <p className={`text-xs sm:text-sm font-bold uppercase animate-pulse ${isDarkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                      LOADING LOGO 1...
                    </p>
                  </div>
                )}
              </div>
              <div className="flex-1 w-full">
                {logoData ? (
                  <div className="space-y-2 sm:space-y-3 text-center sm:text-left">
                    <p className={`font-black text-base sm:text-lg uppercase ${isDarkMode ? 'text-white' : 'text-black'}`}>
                      âœ“ LOGO 1 LOADED
                    </p>
                    <label className="inline-block">
                      <span className={`btn text-xs sm:text-sm font-bold uppercase cursor-pointer px-2 sm:px-3 py-1 sm:py-2 transition-all duration-200 border-2 inline-block ${
                        isDarkMode 
                          ? 'text-white border-white hover:bg-white hover:text-black' 
                          : 'text-black border-black hover:bg-black hover:text-white'
                      }`}>
                        GANTI LOGO 1
                      </span>
                      <input 
                        type="file" 
                        className="hidden" 
                        accept="image/*"
                        onChange={handleLogoUpload}
                      />
                    </label>
                  </div>
                ) : (
                  <div className="space-y-2 sm:space-y-3 text-center sm:text-left">
                    <p className={`font-black text-base sm:text-lg uppercase ${isDarkMode ? 'text-white' : 'text-black'}`}>
                      âš  LOGO 1 TIDAK DITEMUKAN
                    </p>
                    <label className={`inline-block btn px-4 sm:px-6 py-2 sm:py-3 cursor-pointer transition-all duration-200 border-2 sm:border-4 font-black uppercase ${
                      isDarkMode 
                        ? 'bg-white text-black border-white hover:bg-black hover:text-white' 
                        : 'bg-black text-white border-black hover:bg-white hover:text-black'
                    }`}>
                      <span className="text-xs sm:text-sm">UPLOAD LOGO 1</span>
                      <input 
                        type="file" 
                        className="hidden" 
                        accept="image/*"
                        onChange={handleLogoUpload}
                      />
                    </label>
                  </div>
                )}
              </div>
            </div>
          </div>

          {/* Logo 2 */}
          <div>
            <h3 className={`text-lg sm:text-xl font-black mb-3 uppercase ${isDarkMode ? 'text-white' : 'text-black'}`}>
              LOGO 2 - PATIKA
            </h3>
            <div className="flex flex-col sm:flex-row items-center gap-4 sm:gap-6">
              <div className={`flex flex-col items-center justify-center w-40 h-40 sm:w-48 sm:h-48 border-2 sm:border-4 ${
                isDarkMode ? 'border-white bg-gray-700' : 'border-black bg-gray-50'
              }`}>
                {logo2Data ? (
                  <img src={logo2Data} alt="Logo 2" className="w-28 h-28 sm:w-32 sm:h-32 object-contain" />
                ) : (
                  <div className="text-center">
                    <p className={`text-xs sm:text-sm font-bold uppercase animate-pulse ${isDarkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                      LOADING LOGO 2...
                    </p>
                  </div>
                )}
              </div>
              <div className="flex-1 w-full">
                {logo2Data ? (
                  <div className="space-y-2 sm:space-y-3 text-center sm:text-left">
                    <p className={`font-black text-base sm:text-lg uppercase ${isDarkMode ? 'text-white' : 'text-black'}`}>
                      âœ“ LOGO 2 LOADED
                    </p>
                    <label className="inline-block">
                      <span className={`btn text-xs sm:text-sm font-bold uppercase cursor-pointer px-2 sm:px-3 py-1 sm:py-2 transition-all duration-200 border-2 inline-block ${
                        isDarkMode 
                          ? 'text-white border-white hover:bg-white hover:text-black' 
                          : 'text-black border-black hover:bg-black hover:text-white'
                      }`}>
                        GANTI LOGO 2
                      </span>
                      <input 
                        type="file" 
                        className="hidden" 
                        accept="image/*"
                        onChange={handleLogo2Upload}
                      />
                    </label>
                  </div>
                ) : (
                  <div className="space-y-2 sm:space-y-3 text-center sm:text-left">
                    <p className={`font-black text-base sm:text-lg uppercase ${isDarkMode ? 'text-white' : 'text-black'}`}>
                      âš  LOGO 2 TIDAK DITEMUKAN
                    </p>
                    <label className={`inline-block btn px-4 sm:px-6 py-2 sm:py-3 cursor-pointer transition-all duration-200 border-2 sm:border-4 font-black uppercase ${
                      isDarkMode 
                        ? 'bg-white text-black border-white hover:bg-black hover:text-white' 
                        : 'bg-black text-white border-black hover:bg-white hover:text-black'
                    }`}>
                      <span className="text-xs sm:text-sm">UPLOAD LOGO 2</span>
                      <input 
                        type="file" 
                        className="hidden" 
                        accept="image/*"
                        onChange={handleLogo2Upload}
                      />
                    </label>
                  </div>
                )}
              </div>
            </div>
          </div>
        </div>

        {/* EXCEL UPLOAD */}
        <div className={`card border-2 sm:border-4 p-4 sm:p-8 mb-4 sm:mb-8 animate-fadeInUp ${
          isDarkMode 
            ? 'bg-gray-800 border-white shadow-[4px_4px_0px_0px_rgba(255,255,255,1)] sm:shadow-[8px_8px_0px_0px_rgba(255,255,255,1)]' 
            : 'bg-white border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] sm:shadow-[8px_8px_0px_0px_rgba(0,0,0,1)]'
        }`} style={{animationDelay: '0.2s'}}>
          <h2 className={`text-xl sm:text-2xl font-black mb-4 sm:mb-6 uppercase tracking-wide ${isDarkMode ? 'text-white' : 'text-black'}`}>
            UPLOAD FILE EXCEL
          </h2>
          <label className={`flex flex-col items-center justify-center w-full h-36 sm:h-48 border-2 sm:border-4 border-dashed cursor-pointer transition-all duration-300 ${
            isDarkMode 
              ? 'border-white hover:bg-gray-700' 
              : 'border-black hover:bg-gray-100'
          }`}>
            <div className="flex flex-col items-center justify-center pt-4 pb-4 sm:pt-5 sm:pb-6 px-3">
              <p className={`mb-2 text-xs sm:text-sm font-black uppercase tracking-wider text-center ${isDarkMode ? 'text-white' : 'text-black'}`}>
                CLICK TO UPLOAD ATAU DRAG AND DROP
              </p>
              <p className={`text-xs font-bold uppercase tracking-wide ${isDarkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                EXCEL FILE (.XLSX, .XLS)
              </p>
            </div>
            <input 
              type="file" 
              className="hidden" 
              accept=".xlsx,.xls"
              onChange={handleFileUpload}
            />
          </label>
          
          {excelData.length > 0 && (
            <div className={`mt-4 sm:mt-6 p-3 sm:p-4 border-2 sm:border-4 animate-slideIn ${
              isDarkMode ? 'bg-gray-700 border-white' : 'bg-white border-black'
            }`}>
              <p className={`font-black text-base sm:text-lg uppercase ${isDarkMode ? 'text-white' : 'text-black'}`}>
                {excelData.length} DATA BERHASIL DIIMPORT
              </p>
            </div>
          )}
        </div>

        {/* BULK ACTIONS */}
        {excelData.length > 0 && (
          <div className={`card border-2 sm:border-4 p-4 sm:p-6 mb-4 sm:mb-8 animate-fadeInUp ${
            isDarkMode 
              ? 'bg-gray-800 border-white shadow-[4px_4px_0px_0px_rgba(255,255,255,1)] sm:shadow-[8px_8px_0px_0px_rgba(255,255,255,1)]' 
              : 'bg-white border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] sm:shadow-[8px_8px_0px_0px_rgba(0,0,0,1)]'
          }`} style={{animationDelay: '0.3s'}}>
            <h2 className={`text-xl sm:text-2xl font-black mb-4 sm:mb-6 uppercase tracking-wide ${isDarkMode ? 'text-white' : 'text-black'}`}>
              BULK ACTIONS - ALL CVs ({excelData.length} PERSONS)
            </h2>
            <div className="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-6">
              <button
                onClick={bulkPrintPDF}
                disabled={isGenerating}
                className={`btn font-black py-3 sm:py-4 px-4 sm:px-6 border-2 sm:border-4 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed uppercase tracking-wide text-xs sm:text-sm ${
                  isDarkMode
                    ? 'bg-white text-black border-white shadow-[3px_3px_0px_0px_rgba(255,255,255,1)] sm:shadow-[4px_4px_0px_0px_rgba(255,255,255,1)] hover:bg-black hover:text-white'
                    : 'bg-black text-white border-black shadow-[3px_3px_0px_0px_rgba(0,0,0,1)] sm:shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] hover:bg-white hover:text-black'
                }`}
              >
                {isGenerating ? 'GENERATING...' : 'PRINT ALL TO PDF'}
              </button>
              <button
                onClick={bulkDownloadHTML}
                className={`btn font-black py-3 sm:py-4 px-4 sm:px-6 border-2 sm:border-4 transition-all duration-200 uppercase tracking-wide text-xs sm:text-sm ${
                  isDarkMode
                    ? 'bg-gray-800 text-white border-white shadow-[3px_3px_0px_0px_rgba(255,255,255,1)] sm:shadow-[4px_4px_0px_0px_rgba(255,255,255,1)] hover:bg-white hover:text-black'
                    : 'bg-white text-black border-black shadow-[3px_3px_0px_0px_rgba(0,0,0,1)] sm:shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] hover:bg-black hover:text-white'
                }`}
              >
                DOWNLOAD ALL AS HTML
              </button>
            </div>
            <p className={`text-xs sm:text-sm mt-3 sm:mt-4 font-bold uppercase tracking-wide text-center sm:text-left ${
              isDarkMode ? 'text-gray-300' : 'text-gray-700'
            }`}>
              BULK ACTIONS AKAN MEMPROSES SEMUA {excelData.length} CV SEKALIGUS DALAM SATU FILE
            </p>
          </div>
        )}

        {/* DATA LIST WITH PHOTO UPLOAD */}
        {excelData.length > 0 && (
          <div className={`card border-2 sm:border-4 p-4 sm:p-6 mb-4 sm:mb-8 animate-fadeInUp ${
            isDarkMode 
              ? 'bg-gray-800 border-white shadow-[4px_4px_0px_0px_rgba(255,255,255,1)] sm:shadow-[8px_8px_0px_0px_rgba(255,255,255,1)]' 
              : 'bg-white border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] sm:shadow-[8px_8px_0px_0px_rgba(0,0,0,1)]'
          }`} style={{animationDelay: '0.4s'}}>
            <h2 className={`text-xl sm:text-2xl font-black mb-4 sm:mb-6 uppercase tracking-wide ${isDarkMode ? 'text-white' : 'text-black'}`}>
              UPLOAD FOTO & PILIH DATA
            </h2>
            <div className="space-y-3 sm:space-y-4">
              {excelData.map((person, idx) => (
                <div 
                  key={idx}
                  className={`card p-3 sm:p-5 border-2 sm:border-4 transition-all duration-300 ${
                    selectedPerson === person 
                      ? isDarkMode
                        ? 'bg-white text-black border-white shadow-[4px_4px_0px_0px_rgba(255,255,255,0.3)] sm:shadow-[6px_6px_0px_0px_rgba(255,255,255,0.3)]'
                        : 'bg-black text-white border-black shadow-[4px_4px_0px_0px_rgba(255,255,255,0.3)] sm:shadow-[6px_6px_0px_0px_rgba(255,255,255,0.3)]'
                      : isDarkMode
                        ? 'bg-gray-700 border-white hover:bg-gray-600 shadow-[3px_3px_0px_0px_rgba(255,255,255,1)] sm:shadow-[4px_4px_0px_0px_rgba(255,255,255,1)]'
                        : 'bg-white border-black hover:bg-gray-100 shadow-[3px_3px_0px_0px_rgba(0,0,0,1)] sm:shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]'
                  }`}
                  style={{animation: 'slideIn 0.5s ease-out', animationDelay: `${0.1 * idx}s`}}
                >
                  <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-4">
                    <div 
                      className="flex-1 cursor-pointer w-full"
                      onClick={() => setSelectedPerson(person)}
                    >
                      <h3 className={`font-black text-base sm:text-lg mb-1 uppercase tracking-wide ${
                        selectedPerson === person 
                          ? isDarkMode ? 'text-black' : 'text-white'
                          : isDarkMode ? 'text-white' : 'text-black'
                      }`}>
                        {person.full_name || 'NO NAME'}
                      </h3>
                      <p className={`text-xs sm:text-sm font-bold uppercase tracking-wider ${
                        selectedPerson === person 
                          ? isDarkMode ? 'text-gray-700' : 'text-gray-300'
                          : isDarkMode ? 'text-gray-300' : 'text-gray-700'
                      }`}>
                        {person.date_of_birth || 'NO DOB'} â€¢ {person.nationality || 'NO NATIONALITY'} â€¢ {person.position_applied || 'NO POSITION'}
                      </p>
                    </div>
                    
                    <div className="flex items-center gap-3 sm:gap-4 w-full sm:w-auto justify-between sm:justify-end">
                      {photos[idx] ? (
                        <div className="relative">
                          <img 
                            src={photos[idx]} 
                            alt="Preview" 
                            className={`w-14 h-16 sm:w-16 sm:h-20 object-cover border-2 sm:border-4 ${
                              isDarkMode ? 'border-white' : 'border-black'
                            }`}
                          />
                          <button
                            onClick={() => removePhoto(idx)}
                            className={`absolute -top-1 -right-1 sm:-top-2 sm:-right-2 border-2 px-1.5 py-0.5 sm:px-2 sm:py-1 transition-all duration-200 font-black text-xs ${
                              isDarkMode
                                ? 'bg-white text-black border-black hover:bg-black hover:text-white hover:border-white'
                                : 'bg-black text-white border-white hover:bg-white hover:text-black hover:border-black'
                            }`}
                          >
                            âœ•
                          </button>
                        </div>
                      ) : (
                        <label className={`btn cursor-pointer border-2 sm:border-4 border-dashed p-2 sm:p-3 flex flex-col items-center justify-center transition-all duration-300 ${
                          selectedPerson === person 
                            ? isDarkMode
                              ? 'border-black bg-black text-white'
                              : 'border-white bg-white text-black'
                            : isDarkMode
                              ? 'border-white bg-gray-600 hover:bg-gray-500 text-white'
                              : 'border-black bg-gray-100 hover:bg-gray-200 text-black'
                        }`}>
                          <span className="text-xs font-black uppercase tracking-wide">UPLOAD FOTO</span>
                          <input 
                            type="file" 
                            className="hidden" 
                            accept="image/*"
                            onChange={(e) => handlePhotoUpload(idx, e)}
                          />
                        </label>
                      )}
                      
                      {selectedPerson === person && (
                        <div className={`px-3 py-1 sm:px-4 sm:py-2 text-xs sm:text-sm font-black border-2 uppercase tracking-wide whitespace-nowrap animate-slideIn ${
                          isDarkMode
                            ? 'bg-black text-white border-black'
                            : 'bg-white text-black border-white'
                        }`}>
                          SELECTED
                        </div>
                      )}
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        )}

        {/* SINGLE CV ACTIONS */}
        {selectedPerson && (
          <div className={`card border-2 sm:border-4 p-4 sm:p-6 animate-fadeInUp ${
            isDarkMode 
              ? 'bg-gray-800 border-white shadow-[4px_4px_0px_0px_rgba(255,255,255,1)] sm:shadow-[8px_8px_0px_0px_rgba(255,255,255,1)]' 
              : 'bg-white border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] sm:shadow-[8px_8px_0px_0px_rgba(0,0,0,1)]'
          }`}>
            <h2 className={`text-xl sm:text-2xl font-black mb-4 sm:mb-6 uppercase tracking-wide text-center sm:text-left ${
              isDarkMode ? 'text-white' : 'text-black'
            }`}>
              SINGLE CV UNTUK: <span className="underline block sm:inline mt-1 sm:mt-0">{selectedPerson.full_name}</span>
            </h2>
            <div className="grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-6">
              <button
                onClick={previewCV}
                className={`btn font-black py-3 sm:py-4 px-4 sm:px-6 border-2 sm:border-4 transition-all duration-200 uppercase tracking-wide text-xs sm:text-sm ${
                  isDarkMode
                    ? 'bg-gray-800 text-white border-white shadow-[3px_3px_0px_0px_rgba(255,255,255,1)] sm:shadow-[4px_4px_0px_0px_rgba(255,255,255,1)] hover:bg-white hover:text-black'
                    : 'bg-white text-black border-black shadow-[3px_3px_0px_0px_rgba(0,0,0,1)] sm:shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] hover:bg-black hover:text-white'
                }`}
              >
                PREVIEW CV
              </button>
              <button
                onClick={downloadPDF}
                disabled={isGenerating}
                className={`btn font-black py-3 sm:py-4 px-4 sm:px-6 border-2 sm:border-4 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed uppercase tracking-wide text-xs sm:text-sm ${
                  isDarkMode
                    ? 'bg-white text-black border-white shadow-[3px_3px_0px_0px_rgba(255,255,255,1)] sm:shadow-[4px_4px_0px_0px_rgba(255,255,255,1)] hover:bg-black hover:text-white'
                    : 'bg-black text-white border-black shadow-[3px_3px_0px_0px_rgba(0,0,0,1)] sm:shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] hover:bg-white hover:text-black'
                }`}
              >
                {isGenerating ? 'GENERATING...' : 'PRINT TO PDF'}
              </button>
              <button
                onClick={downloadHTML}
                className={`btn font-black py-3 sm:py-4 px-4 sm:px-6 border-2 sm:border-4 transition-all duration-200 uppercase tracking-wide text-xs sm:text-sm ${
                  isDarkMode
                    ? 'bg-gray-800 text-white border-white shadow-[3px_3px_0px_0px_rgba(255,255,255,1)] sm:shadow-[4px_4px_0px_0px_rgba(255,255,255,1)] hover:bg-white hover:text-black'
                    : 'bg-white text-black border-black shadow-[3px_3px_0px_0px_rgba(0,0,0,1)] sm:shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] hover:bg-black hover:text-white'
                }`}
              >
                DOWNLOAD HTML
              </button>
            </div>
            <p className={`text-xs sm:text-sm text-center mt-4 sm:mt-6 font-bold uppercase tracking-wide px-2 ${
              isDarkMode ? 'text-gray-300' : 'text-gray-700'
            }`}>
              KLIK "PRINT TO PDF" AKAN MEMBUKA DIALOG PRINT BROWSER. PILIH "SAVE AS PDF" SEBAGAI PRINTER.
            </p>
          </div>
        )}
      </div>
    </div>
  );
};

export default CVImportGenerator;